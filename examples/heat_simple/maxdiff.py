from femformal.core.fem.heatlinfem import heatlinfem
import femformal.core.fem.fem_util as fem
import femformal.core.system as s
import numpy as np


Ns = [10, 20, 30, 40, 50]
Nlen = len(Ns)
L = 10.0
T = [10.0, 100.0]
dt = .1

systrue, xparttrue, _ = heatlinfem(1000, L, T)
systems, xparts, _ = zip(*[heatlinfem(N, L, T) for N in Ns])
dsystems = [s.cont_to_disc(system, dt) for system in systems]

t0, tt = 1, 10
xl = 1.0
xr = 9.0
mds = [fem.max_diff(system, dt, xpart, t0, tt, xl, xr, T, systrue, 0.01, xparttrue)
       for system, xpart in zip(systems, xparts)]

mdxs = [fem.max_xdiff(system, dt, xpart, t0, tt, T)
        for system, xpart in zip(systems, xparts)]
mdtxs = [fem.max_tdiff(system, dt, xpart, t0, tt, T)
        for system, xpart in zip(dsystems, xparts)]

# print mds
print mdxs
print mdtxs

# Results
# mds = [5.2884818800547961, 1.4886301139418237, 0.675864781296589, 0.37390643814340763, 0.23786780480595837]


# mdxs = [array([ 43.61581335,  29.3081265 ,  17.55192127,  15.72098218,
#         13.25545309,   9.71373527,  12.43416476,  17.43833879,
#         29.26548574,  44.07015286]), array([ 20.9596702 ,  19.1568934 ,  15.80439615,  12.16137934,
#          9.59742404,   8.33715418,   8.15655271,   7.77144973,
#          7.09253827,   6.22468152,   5.61898297,   5.13085328,
#          5.80372547,   6.69473288,   7.91083596,   9.66803934,
#         12.43377018,  17.11458991,  21.79965605,  24.07977653]), array([ 16.36595727,  15.65564135,  14.06224732,  11.96591911,
#          9.66747946,   7.90943556,   6.69461814,   5.80267361,
#          5.459644  ,   5.30722476,   5.09255673,   4.80591063,
#          4.44328133,   4.00894383,   3.51668152,   3.35805277,
#          3.26872287,   3.48770456,   3.78669805,   4.14611771,
#          4.58203693,   5.12061742,   5.80279234,   6.69465469,
#          7.90931839,   9.66821092,  11.98903659,  14.11454786,
#         15.73242549,  16.45418165]), array([ 12.22817496,  11.93156096,  11.24571964,  10.2886243 ,
#          9.13794478,   7.87986416,   6.68920765,   5.80069584,
#          5.11956043,   4.58113362,   4.17525938,   3.85913513,
#          3.54795166,   3.48714009,   3.45573001,   3.41071652,
#          3.34887954,   3.26693715,   3.16189064,   3.03144364,
#          2.87444184,   2.69126266,   2.49624259,   2.64190087,
#          2.81008953,   3.00309315,   3.22521672,   3.48305268,
#          3.7857515 ,   4.14604562,   4.5820989 ,   5.12049109,
#          5.80225131,   6.69470544,   7.90071874,   9.21318439,
#         10.418954  ,  11.42526973,  12.14806588,  12.46103488]), array([  9.91873189,   9.76083403,   9.39094286,   8.86152456,
#          8.20150381,   7.44521466,   6.62943039,   5.80139303,
#          5.11997003,   4.5812506 ,   4.14545191,   3.78560044,
#          3.48289826,   3.22512962,   3.00277986,   2.91484092,
#          2.85020423,   2.7802586 ,   2.70275513,   2.61570783,
#          2.51755316,   2.43721762,   2.43546188,   2.43002465,
#          2.42050819,   2.40628999,   2.38654463,   2.36028255,
#          2.32640398,   2.28377216,   2.23394435,   2.35410233,
#          2.48835741,   2.63907072,   2.80918653,   3.00282996,
#          3.22521387,   3.48307427,   3.78572821,   4.14596044,
#          4.58202887,   5.12025383,   5.80271383,   6.64269215,
#          7.47695445,   8.25187531,   8.92921881,   9.47318884,
#          9.85356513,  10.01600912])]
# mdtxs = [array([ 0.        ,  1.56261815,  1.63770518,  0.89799818,  0.51081857,
#         0.42078015,  0.66180079,  1.12257737,  1.897392  ,  1.79182204,  0.        ]), array([ 0.        ,  0.93863541,  1.63273966,  1.86944789,  1.69790216,
#         1.30017484,  0.9127879 ,  0.67316229,  0.51640602,  0.40858443,
#         0.36039283,  0.48363727,  0.65879018,  0.84116965,  1.06085834,
#         1.45248689,  1.88203844,  2.11596314,  1.87549559,  1.08640589,  0.        ]), array([ 0.        ,  0.72899354,  1.3658782 ,  1.80506301,  2.00712198,
#         1.98392987,  1.78693209,  1.48671767,  1.16159094,  0.91901672,
#         0.74532729,  0.61643355,  0.51836204,  0.44185099,  0.44379893,
#         0.45183391,  0.44102302,  0.5287199 ,  0.64462111,  0.77231573,
#         0.9110461 ,  1.100726  ,  1.38746876,  1.74572877,  2.05862609,
#         2.25176649,  2.25246179,  2.00916074,  1.51208301,  0.80484836,  0.        ]), array([ 0.        ,  0.55822015,  1.07629613,  1.50381261,  1.81110054,
#         1.98447825,  2.02655284,  1.95379468,  1.79219985,  1.57215391,
#         1.32359189,  1.0954507 ,  0.92089997,  0.78539794,  0.6774498 ,
#         0.59038531,  0.54016545,  0.51525799,  0.48108138,  0.44947922,
#         0.45595224,  0.44955586,  0.49733489,  0.60074126,  0.70410254,
#         0.80884687,  0.9161042 ,  1.02956188,  1.15677991,  1.30680482,
#         1.53450118,  1.79444203,  2.01969279,  2.17924024,  2.2419011 ,
#         2.1812643 ,  1.98092988,  1.63892983,  1.17018947,  0.60618787,  0.        ]), array([ 0.        ,  0.39831978,  0.77791517,  1.1143266 ,  1.39081859,
#         1.59599139,  1.72446782,  1.77686536,  1.75911665,  1.68129022,
#         1.58732949,  1.47107167,  1.33241208,  1.18152314,  1.0314788 ,
#         0.90459978,  0.79901172,  0.71044758,  0.63543657,  0.57129601,
#         0.51655679,  0.46907443,  0.42777791,  0.44210357,  0.46740853,
#         0.48430688,  0.49197603,  0.49007482,  0.52703413,  0.60733795,
#         0.6940804 ,  0.78209543,  0.87177251,  0.96512468,  1.06468197,
#         1.17349516,  1.29892165,  1.44523211,  1.63021335,  1.82646708,
#         1.99745554,  2.12749926,  2.20076555,  2.20284961,  2.12249738,
#         1.9532474 ,  1.69474305,  1.35348209,  0.94283173,  0.48223689,  0.        ])]
