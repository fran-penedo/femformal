import numpy as np
from femformal.core import logic as logic
from femformal.core.fem import fem_util as fem
from femformal.core.fem.heatlinfem import heatlinfem


N = 50
L = 10.0
T = [10.0, 100.0]
dt = .1

apc1 = logic.APCont([1, 9], -1, lambda x: 9.0 * x)
apc2 = logic.APCont([6, 7], 1, lambda x: 9.0 * x + 15.0)
cregions = {'A': apc1, 'B': apc2}

cspec = "((G_[1, 10] (A)) & (F_[4, 6] (B)))"
# t \in [1,10], T = [10, 100], x \in [1, 9], N = [10, 20, 30, 40, 50], L = 10
eps = 0.238
eta = [  9.91873189,   9.76083403,   9.39094286,   8.86152456,
        8.20150381,   7.44521466,   6.62943039,   5.80139303,
        5.11997003,   4.5812506 ,   4.14545191,   3.78560044,
        3.48289826,   3.22512962,   3.00277986,   2.91484092,
        2.85020423,   2.7802586 ,   2.70275513,   2.61570783,
        2.51755316,   2.43721762,   2.43546188,   2.43002465,
        2.42050819,   2.40628999,   2.38654463,   2.36028255,
        2.32640398,   2.28377216,   2.23394435,   2.35410233,
        2.48835741,   2.63907072,   2.80918653,   3.00282996,
        3.22521387,   3.48307427,   3.78572821,   4.14596044,
        4.58202887,   5.12025383,   5.80271383,   6.64269215,
        7.47695445,   8.25187531,   8.92921881,   9.47318884,
        9.85356513,  10.01600912]
nu = [ 0.        ,  0.39831978,  0.77791517,  1.1143266 ,  1.39081859,
       1.59599139,  1.72446782,  1.77686536,  1.75911665,  1.68129022,
       1.58732949,  1.47107167,  1.33241208,  1.18152314,  1.0314788 ,
       0.90459978,  0.79901172,  0.71044758,  0.63543657,  0.57129601,
       0.51655679,  0.46907443,  0.42777791,  0.44210357,  0.46740853,
       0.48430688,  0.49197603,  0.49007482,  0.52703413,  0.60733795,
       0.6940804 ,  0.78209543,  0.87177251,  0.96512468,  1.06468197,
       1.17349516,  1.29892165,  1.44523211,  1.63021335,  1.82646708,
       1.99745554,  2.12749926,  2.20076555,  2.20284961,  2.12249738,
       1.9532474 ,  1.69474305,  1.35348209,  0.94283173,  0.48223689,  0.        ]


# pset = np.array([[1, 0, 9], [-1, 0, -9], [0, 1, 13.0], [0, -1, -5.0]])
pset = np.array([[1, 0, 9], [-1, 0, -9], [0, 1, 13.0], [0, -1, -5.0]])
f = lambda x, p: p[0] * x + p[1]

system = heatlinfem(N, L, T, dt)
system = system.to_canon()

cs = fem.build_cs(system, None, T, cregions,
                  cspec, eps=eps, eta=eta, nu=nu, pset=pset, f=f)

print "loaded cs"

# a = 9, 5 < b < 13
# Res: 0.491760976918
# Time 21.2935700417

# a = 9, 5 < b < 15
# Res: -0.672610488252
# Time 22.1673059464

# a = 9, 0 < b < 10
# Res: -2.82205527461
# Time 21.976569891

# 8 < a < 10, 5 < b < 13
# Res: -5.02161266932
# Time 378.58917594

# 8.5 < a < 9.5, 8 < b < 10
# Res: 0.450312253868
# Time 325.876770973

# 5 < a < 12, 0 < b < 20
# Res: -29.5582217521
# Time 81.8781380653
