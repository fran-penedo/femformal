import examples.heatlinfem as fem
import femformal.util as u
import femformal.logic as logic
import numpy as np


Ns = [50 for i in range(50)]
Nlen = len(Ns)
L = 10.0
T = [10.0, 100.0]
dt = .1
# ablist = [((np.random.rand() * 4 - 2) * abs(T[1] - T[0]) / L,
#           np.random.rand() * abs(T[1] - T[0]))
#           for N in Ns]
ablist = [
 (5.010633504873983, 23.302098979971348),
 (-14.694938385207744, 36.630383112605394),
 (-6.0445425127146795, 80.87008508630994),
 (11.4781804587297, 3.9649792723793564),
 (3.7082817514645745, 74.01390422706666),
 (12.18854066337395, 77.57403179686395),
 (17.565169482152502, 83.2308603844469),
 (-12.427285297642271, 75.07625114653213),
 (6.605682185876253, 1.7790603179978004),
 (8.985886770158197, 79.52034734663962),
 (5.942199182839988, 46.42631782978602),
 (-14.872947703697132, 33.8777444067672),
 (-14.37532325088869, 74.74636685886735),
 (12.651663805270362, 86.79467176096047),
 (7.629697191850619, 77.36048036365212),
 (-9.83012800091654, 20.459631176064793),
 (16.89275207938106, 22.305505346152835),
 (-0.8607617419343722, 46.637217101830494),
 (6.128627418998578, 3.624817436818325),
 (-16.502007871518344, 41.630997206368505),
 (-4.805359390574727, 27.115810023962233),
 (0.285755823934692, 6.316473152818956),
 (8.842388178227393, 59.66018745738115),
 (-4.088868943385749, 34.2848142985384),
 (-16.284653131132835, 85.57227263787048),
 (5.592455774855856, 9.672997250437563),
 (-17.30793904130026, 77.98167118979761),
 (-10.75253243298896, 34.75399171488918),
 (-10.157333012864422, 55.035278563865646),
 (-12.915432943758669, 1.505744147678335),
 (-13.478543418531356, 74.60501668553329),
 (2.801624814566894, 37.52083190949668),
 (3.0542025014243963, 54.27351075340623),
 (-5.603669608752398, 89.17714438894674),
 (-8.477113158660977, 8.642460272757498),
 (16.90883017103746, 73.60982864948586),
 (-12.148416313803146, 19.914596796240403),
 (-7.967543463056113, 34.97653194626451),
 (3.750991481879616, 56.67017015804738),
 (-3.4317286821770088, 23.259027053201116),
 (7.027840217221582, 34.0280349574753),
 (0.8708789142336091, 39.87380054910484),
 (7.941740185507108, 36.370897292678904),
 (11.833360587444146, 54.75395703940606),
 (2.8301464201320536, 34.69995637788964),
 (9.387021542577727, 14.413076397031638),
 (-12.994439362874573, 20.411901478372204),
 (-4.642497017828057, 38.773022060367275),
 (-16.259817033882577, 28.85387755164763),
 (6.151313862951533, 75.10748858227345)]

d0s = [[T[0]] + [min(max(a * x + b, T[0]), T[1])
                 for x in np.linspace(0, L, N + 1)[1:-1]] + [T[1]]
       for (a, b), N in zip(ablist, Ns)]

apc1 = logic.APCont([1, 9], -1, lambda x: 9.0 * x)
apc2 = logic.APCont([6, 7], 1, lambda x: 9.0 * x + 15.0)
cregions = {'A': apc1, 'B': apc2}

cspec = "((G_[1, 10] (A)) & (F_[4, 6] (B)))"
# t \in [1,10], T = [10, 100], x \in [1, 9], N = [10, 20, 30, 40, 50], L = 10
eps = [1.0 for N in Ns]

cstrues = [fem.build_cs(
    1000, L, T, 0.01, [T[0]] + [min(max(a * x + b, T[0]), T[1])
                 for x in np.linspace(0, L, 1000 + 1)[1:-1]] + [T[1]],
    cregions, cspec, discretize_system=False) for (a, b), N in zip(ablist, Ns)]

cslist = [fem.build_cs(N, L, T, dt, d0, cregions, cspec, eps=e)
          for N, d0, e in zip(Ns, d0s, eps)]

print "loaded cs"


# No eps
# times: [48.893373012542725, 49.90970993041992, 50.3910129070282, 50.74644207954407, 50.52164602279663, 50.42991304397583, 50.94157290458679, 51.73954701423645, 51.55245113372803, 52.632718086242676, 53.21016502380371, 54.085521936416626, 54.57320809364319, 54.617215156555176, 54.987509965896606, 55.439756870269775, 56.02452898025513, 53.0288188457489, 53.517695903778076, 52.98933386802673, 52.899139165878296, 53.534428119659424, 55.57452392578125, 56.571183919906616, 57.13955092430115, 55.27966094017029, 55.45153999328613, 55.09257388114929, 55.510470151901245, 56.80233097076416, 57.572551012039185, 56.88205599784851, 56.55246686935425, 54.77645301818848, 59.55672812461853, 55.173027992248535, 60.74354600906372, 56.129393100738525, 56.89080190658569, 56.78243088722229, 56.86236500740051, 52.33983612060547, 57.81936311721802, 59.02333211898804, 54.944713830947876, 57.63721680641174, 55.54130506515503, 56.488415002822876, 59.235984086990356, 55.80729293823242]
# results: [-4.592114170507443, -50.47417657767113, -26.834208612163252, 0.6429290282159172, -18.20133859787626, -22.72221956184319, -22.9706142652567, -49.95855636813559, -13.873943377152614, -22.59564212736126, -8.352806553887035, -50.474316954728636, -50.28441412788163, -22.97354084349041, -22.215567666426864, -50.47445910416138, -16.388042416616486, -22.709661447057385, -15.298879651171092, -50.47400400884476, -50.46522635437873, -50.47447606709267, -19.632688606512488, -49.975907328929736, -50.19939880850018, -13.204622115524558, -50.4007848530199, -50.47355499363886, -50.35739163751691, -50.47447606709267, -50.17843863533619, -6.618472208201297, -3.484980450136675, -16.958156988093947, -50.47447606709267, -22.77113459061826, -50.47446896058295, -50.46871852046661, -7.502362682724765, -50.46169458315046, -3.9786342271752346, -17.260126510474436, -8.3336535615054, -20.334561133615694, -8.878828352210007, 0.7724322504777206, -50.47446917642583, -49.73776880214109, -50.47443675733871, -21.370907291336778]
# true results: [-4.5636136465050896, -50.57559802249208, -26.945065122076372, 0.54340945219682624, -18.60862730561503, -23.21288774379714, -23.470185404782356, -50.095420419237726, -13.838862801848961, -23.08404974335501, -8.6215267506235023, -50.575694162441124, -50.418741839454327, -23.47399745941793, -22.6922767230772, -50.575788343922845, -16.70784848218733, -22.776536043373042, -15.285467355270832, -50.57548667919454, -50.568415732801647, -50.575798342771982, -20.045190062031125, -50.120159460499934, -50.34762136705195, -13.185629567456871, -50.516281424093677, -50.575157625099877, -50.478071471444288, -50.575798342771982, -50.326593309576104, -6.6201454854546853, -3.7454281396637299, -17.063582190089804, -50.575798342771982, -23.262169709556176, -50.575794003863052, -50.571376324718443, -7.7946524493507781, -50.565451357606179, -4.1873787457198972, -17.297926837306676, -8.5752745171276672, -20.757435351835312, -8.9026093090825782, 0.64572862056796509, -50.575794009286192, -49.859613602843297, -50.575774458463357, -21.827853905639628]

# With eps
# times: [49.812609910964966, 53.40840697288513, 51.37424898147583, 52.099956035614014, 51.499967098236084, 51.004525899887085, 51.32815098762512, 50.53611087799072, 51.42238903045654, 53.73071599006653, 56.53889608383179, 54.876928091049194, 54.07648015022278, 51.12898015975952, 54.21868014335632, 48.63657903671265, 48.83331608772278, 47.49318194389343, 46.813035011291504, 47.477710008621216, 47.385273933410645, 47.7399218082428, 49.41708517074585, 48.30866503715515, 48.6831111907959, 48.18867611885071, 48.50034999847412, 48.86923694610596, 49.1510591506958, 49.369961977005005, 49.577873945236206, 49.29030895233154, 49.446855783462524, 48.10705804824829, 49.263229846954346, 50.30934405326843, 49.08416986465454, 49.9843270778656, 50.13303804397583, 49.88459897041321, 48.13244318962097, 46.960339069366455, 47.520447969436646, 47.739073038101196, 47.9489529132843, 48.1378390789032, 49.28453493118286, 48.64080309867859, 48.99997401237488, 48.81977605819702]
# results: [-5.592114170507443, -51.47417657767113, -27.834208612163252, -0.35707097180034, -19.20133859787626, -23.72221956184319, -23.9706142652567, -50.95855636813559, -14.873943377152614, -23.59564212736126, -9.352806553887035, -51.474316954728636, -51.28441412788163, -23.97354084349064, -23.215567666426864, -51.47445910416138, -17.388042416616486, -23.709661447057385, -16.29887965117109, -51.47400400884476, -51.46522635437873, -51.47447606709267, -20.632688606512488, -50.975907328929736, -51.19939880850018, -14.204622115524558, -51.4007848530199, -51.47355499363886, -51.35739163751691, -51.47447606709267, -51.17843863533619, -7.618472208201297, -4.484980450136675, -17.958156988093947, -51.47447606709267, -23.771134590618033, -51.47446896058295, -51.46871852046661, -8.502362682724765, -51.46169458315046, -4.978634227175235, -18.260126510474436, -9.3336535615054, -21.334561133615694, -9.878828352210007, -0.22756774953080594, -51.47446917642583, -50.73776880214109, -51.47443675733871, -22.370907291336778]
# true results: [-4.5636136465050896, -50.57559802249208, -26.945065122076372, 0.54340945219682624, -18.60862730561503, -23.21288774379714, -23.470185404782356, -50.095420419237726, -13.838862801848961, -23.08404974335501, -8.6215267506235023, -50.575694162441124, -50.418741839454327, -23.47399745941793, -22.6922767230772, -50.575788343922845, -16.70784848218733, -22.776536043373042, -15.285467355270832, -50.57548667919454, -50.568415732801647, -50.575798342771982, -20.045190062031125, -50.120159460499934, -50.34762136705195, -13.185629567456871, -50.516281424093677, -50.575157625099877, -50.478071471444288, -50.575798342771982, -50.326593309576104, -6.6201454854546853, -3.7454281396637299, -17.063582190089804, -50.575798342771982, -23.262169709556176, -50.575794003863052, -50.571376324718443, -7.7946524493507781, -50.565451357606179, -4.1873787457198972, -17.297926837306676, -8.5752745171276672, -20.757435351835312, -8.9026093090825782, 0.64572862056796509, -50.575794009286192, -49.859613602843297, -50.575774458463357, -21.827853905639628]


